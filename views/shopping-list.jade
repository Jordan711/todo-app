extends layout

block content
  h1= title
  hr
  h2 Add New Shopping List Item
  form#shoppingForm(action="/shopping-list/add", method="POST", autocomplete="off")
    div
      label Item: 
      input(type="text", name="item", required)
    div
      label Quantity: 
      input(type="text", name="quantity", required)
    div
      label Store: 
      input(type="text", name="store", required)
    button(type="submit") Create Shopping List Item

  hr
  h2 Shopping List
  if shoppingList.length === 0
    p No items in the shopping list.
  each item in shoppingList
    p #[strong Item:] #{item.item}
    p #[strong Quantity:] #{item.quantity}
    p #[strong Store:] #{item.store}
    p #[strong Date Posted:] #{item.created_at}
    form.delete-form(action="/shopping-list/delete", method="POST") 
      button(type="submit", name="id", value="#{item.id}") Delete
    hr

  script.
    // Handle Add Form
    document.getElementById('shoppingForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new URLSearchParams(new FormData(form));
      
      await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
      });
      
      window.location.replace('/shopping-list');
    });

    // Handle Delete Forms
    document.querySelectorAll('.delete-form').forEach(form => {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new URLSearchParams();
        formData.append('id', e.submitter.value);
        
        await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
        });
        
        window.location.replace('/shopping-list');
      });
    });
